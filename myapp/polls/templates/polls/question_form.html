{% extends 'polls/base.html' %} {% block title %} {% if form.instance.pk %}Edit
Question{% else %}Create New Poll{% endif %} - Django Polls {% endblock %} {%
block content %}
<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-header">
        <h1 class="h4 mb-0">
          {% if form.instance.pk %}
          <i class="fas fa-edit text-warning"></i> Edit Poll {% else %}
          <i class="fas fa-plus text-primary"></i> Create New Poll {% endif %}
        </h1>
      </div>

      <div class="card-body">
        <form method="post" novalidate>
          {% csrf_token %}

          <!-- Question Text Field -->
          <div class="mb-3">
            <label
              for="{{ form.question_text.id_for_label }}"
              class="form-label"
            >
              Question Text <span class="text-danger">*</span>
            </label>
            {{ form.question_text }} {% if form.question_text.help_text %}
            <div class="form-text">{{ form.question_text.help_text }}</div>
            {% endif %} {% if form.question_text.errors %}
            <div class="text-danger">
              {% for error in form.question_text.errors %}
              <small>{{ error }}</small>
              {% endfor %}
            </div>
            {% endif %}
          </div>

          <!-- Category Field -->
          <div class="mb-3">
            <label for="{{ form.category.id_for_label }}" class="form-label">
              Category
            </label>
            {{ form.category }} {% if form.category.help_text %}
            <div class="form-text">{{ form.category.help_text }}</div>
            {% endif %} {% if form.category.errors %}
            <div class="text-danger">
              {% for error in form.category.errors %}
              <small>{{ error }}</small>
              {% endfor %}
            </div>
            {% endif %}
          </div>

          <!-- Form Buttons -->
          <div class="d-flex gap-2 mt-4">
            <button type="submit" class="btn btn-primary">
              {% if form.instance.pk %}
              <i class="fas fa-save"></i> Update Poll {% else %}
              <i class="fas fa-plus"></i> Create Poll {% endif %}
            </button>

            <a href="{% url 'polls:index' %}" class="btn btn-outline-secondary">
              <i class="fas fa-times"></i> Cancel
            </a>

            {% if form.instance.pk %}
            <a
              href="{% url 'polls:detail' form.instance.pk %}"
              class="btn btn-outline-info"
            >
              <i class="fas fa-eye"></i> View Poll
            </a>
            {% endif %}
          </div>

          <!-- Form Errors -->
          {% if form.non_field_errors %}
          <div class="alert alert-danger mt-3" role="alert">
            {% for error in form.non_field_errors %} {{ error }} {% endfor %}
          </div>
          {% endif %}
        </form>
      </div>
    </div>

    <!-- Help Card -->
    <div class="card mt-4">
      <div class="card-header">
        <h5 class="card-title mb-0">
          <i class="fas fa-lightbulb"></i> Tips for Creating Great Polls
        </h5>
      </div>
      <div class="card-body">
        <ul class="mb-0">
          <li>
            <strong>Be Clear:</strong> Make sure your question is easy to
            understand
          </li>
          <li>
            <strong>Be Specific:</strong> Avoid vague or ambiguous wording
          </li>
          <li>
            <strong>Be Neutral:</strong> Don't lead people toward a particular
            answer
          </li>
          <li>
            <strong>Category:</strong> Choose the most relevant category for
            better discovery
          </li>
          <li>
            <strong>Test it:</strong> Read your question aloud to see if it
            makes sense
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Sidebar with Preview -->
  <div class="col-lg-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0"><i class="fas fa-eye"></i> Preview</h5>
      </div>
      <div class="card-body">
        <div id="preview-content">
          <div class="text-muted text-center py-4">
            <i class="fas fa-poll fa-2x mb-2"></i>
            <p>Your poll preview will appear here as you type</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Polls -->
    <div class="card mt-4">
      <div class="card-header">
        <h5 class="card-title mb-0">
          <i class="fas fa-history"></i> Your Recent Polls
        </h5>
      </div>
      <div class="card-body">
        {% if user.is_authenticated %}
        <!-- This would show user's recent questions -->
        <p class="text-muted small">Your recent polls will appear here</p>
        {% else %}
        <p class="text-muted small">
          <a href="{% url 'admin:login' %}">Login</a> to see your recent polls
        </p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const questionInput = document.getElementById(
      "{{ form.question_text.id_for_label }}"
    );
    const categorySelect = document.getElementById(
      "{{ form.category.id_for_label }}"
    );
    const previewContent = document.getElementById("preview-content");

    function updatePreview() {
      const questionText = questionInput.value.trim();
      const categoryOption =
        categorySelect.options[categorySelect.selectedIndex];
      const categoryText =
        categoryOption.text !== "---------" ? categoryOption.text : "";

      if (questionText) {
        let previewHTML = `
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div>
                            ${
                              categoryText
                                ? `<span class="badge bg-primary">${categoryText}</span>`
                                : ""
                            }
                        </div>
                        <small class="text-muted">
                            <i class="fas fa-calendar-alt"></i> Now
                        </small>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">${questionText}</h5>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between text-muted small">
                                <span><i class="fas fa-list"></i> Choices will appear here</span>
                                <span><i class="fas fa-vote-yea"></i> 0 votes</span>
                            </div>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-primary btn-sm flex-fill" disabled>
                                <i class="fas fa-vote-yea"></i> Vote Now
                            </button>
                            <button class="btn btn-outline-secondary btn-sm flex-fill" disabled>
                                <i class="fas fa-chart-bar"></i> Results
                            </button>
                        </div>
                    </div>
                </div>
            `;
        previewContent.innerHTML = previewHTML;
      } else {
        previewContent.innerHTML = `
                <div class="text-muted text-center py-4">
                    <i class="fas fa-poll fa-2x mb-2"></i>
                    <p>Your poll preview will appear here as you type</p>
                </div>
            `;
      }
    }

    // Update preview on input
    questionInput.addEventListener("input", updatePreview);
    categorySelect.addEventListener("change", updatePreview);

    // Character counter for question text
    const maxLength = questionInput.getAttribute("maxlength");
    if (maxLength) {
      const counterContainer = document.createElement("div");
      counterContainer.className = "form-text";
      questionInput.parentNode.appendChild(counterContainer);

      function updateCounter() {
        const currentLength = questionInput.value.length;
        const remaining = maxLength - currentLength;
        counterContainer.textContent = `${currentLength}/${maxLength} characters`;

        if (remaining < 20) {
          counterContainer.classList.add("text-warning");
        } else {
          counterContainer.classList.remove("text-warning");
        }
      }

      questionInput.addEventListener("input", updateCounter);
      updateCounter(); // Initial count
    }

    // Form validation
    const form = document.querySelector("form");
    form.addEventListener("submit", function (e) {
      const questionText = questionInput.value.trim();

      if (!questionText) {
        e.preventDefault();
        questionInput.classList.add("is-invalid");
        questionInput.focus();
      } else {
        questionInput.classList.remove("is-invalid");
      }
    });

    // Remove validation styling on input
    questionInput.addEventListener("input", function () {
      this.classList.remove("is-invalid");
    });

    // Initial preview update
    updatePreview();
  });
</script>
{% endblock %}
